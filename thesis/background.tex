\chapter{General background}
\label{ch:background}

\section{Notation}
We provide a glossary of notation that will be used in this paper.
As mentioned in the introduction, $p > 2$ is a prime,
$F$ is a finite extension of $\QQ_p$,
and $E/F$ is an unramified quadratic field extension.

\begin{itemize}
  \ii For any $a \in E$, we let $\bar a$ denote the image of $a$
  under the nontrivial automorphism of $\Gal(E/F)$.
  (Hence $a = \bar a$ exactly when $a \in F$.)
  \ii Fix $\eps \in \OO_F^\times$ such that $E = F[\sqrt{\eps}]$.
  \ii Denote by $\varpi$ a uniformizer of $\OO_F$, such that $\bar \varpi = \varpi$.
  \ii Let $q \coloneqq |\OO_F/\varpi|$ be the residue characteristic.
  (Hence $|\OO_E / \varpi| = q^2$.)
  \ii Let $v$ be the associated valuation for $\varpi$.
  \ii Let $\eta$ be the quadratic character attached to $E/F$ by class field theory,
  so that $\eta(x) = -1^{v(x)}$.
  \ii Set $G' \coloneqq \GL_n(E)$.
  \ii Set $K' \coloneqq \GL_n(\OO_E) \subseteq G'$ as the hyperspecial maximal compact subgroup of $G$.
  \ii $V_0$ denotes a split $E/F$-Hermitian space of dimension $n$ (unique up to isomorphism).
  \ii Let $\beta$ denote the $n \times n$ antidiagonal matrix
  \[ \beta \coloneqq \begin{bmatrix} && 1 \\ & \iddots \\ 1 \end{bmatrix} \]
  and pick the basis of $V_0$ such that the Hermitian form on $V_0$ is given by
  \[ V_0 \times V_0 \to E \qquad (x,y) \mapsto x^\ast \beta y. \]
  \ii Set
  \[ G \coloneqq \U(V_0) = \{ g \in \GL_n(\OO_E) \mid g^\ast \beta g = \beta\} \]
  the unitary group over $V_0$.
  Note that $\beta$ is \emph{antidiagonal}, in contrast to the convention $\beta = \id_n$
  that is often used for unitary matrices with entries in $\CC$.
  \ii Set
  \[ K \coloneqq G \cap \GL_n(\OO_E) \]
  as the natural hyperspecial maximal compact subgroup.
  \ii Let $\VV_n$ denote the non-split $E/F$-Hermitian space of dimension $n$
  (unique up to isomorphism), and $\U(\VV_n)$ the corresponding unitary group.
  This space will be realized in \Cref{ch:geo}.
\end{itemize}

\section{The spaces $S_n(F)$ and $S_n(F) \times V'_n$}
For the analytic side of the two AFL conjectures we investigate,
the following two spaces will be used as inputs to our orbital integrals.
\begin{definition}
  [{\cite[(4.10)]{ref:highdim2024}}]
  We define the symmetric space
  \[ S_n(F) \coloneqq \left\{ g \in \GL_n(E) \mid g \bar g = \id_n \right\}. \]
  It has a natural left action of $\GL_n(E)$ by
  \begin{align*}
    \GL_n(E) \times S_n(F) &\to S_n(F) \\
    g \cdot \gamma &\coloneqq g \gamma \bar g^{-1}.
  \end{align*}
\end{definition}

\begin{definition}
  [{\cite[(4.11)]{ref:highdim2024}}]
  We set
  \[ V'_n(F) \coloneqq F^n \times (F^n)^\vee \]
  where $-^\vee$ denotes the $F$-dual space, i.e., $(F^n)^\vee = \Hom_F(F^n, F)$.
  Then we may also consider the augmented space
  \[ S_n(F) \times V'_n(F) \]
  If we identify $F^n$ with column vectors of length $n-1$ and $(F^n)^\vee$
  with row vectors of length $n$ then we have a left action of $\GL_n(F)$ by
  \begin{align*}
    \GL_n(F) \times (S_n(F) \times V'_n)(F)
    &\to S_n(F) \times V'_n(F) \\
    h \cdot (\gamma, \uu, \vv^\top)
    &\coloneqq (h \gamma h^{-1}, h\uu, \vv^\top h^{-1}).
  \end{align*}
  Note that according to the embedding
  \begin{align*}
    S_n(F) \times V'_n(F)
    &\hookrightarrow \GL_{n+1}(E) \\
    (\gamma, \uu, \vv^\top)
    &\mapsto \begin{bmatrix} \gamma & \uu \\ \vv^\top & 0 \end{bmatrix}
  \end{align*}
  we can consider elements of $S_n(F) \times V'_n(F)$ as elements of $\GL_{n+1}(E)$ too.
  In that case the action of $h \in \GL_{n+1}(F)$
  coincides with $h \cdot g \mapsto hg\bar{h}^{-1}$ as well.
\end{definition}

\begin{definition}
  For brevity, let
   \[ K'_S \coloneqq S_n(F) \cap \GL_n(\OO_F). \]
\end{definition}

\section{Definition of Hecke algebra}
We reminder the reader the definition of a Hecke algebra.
For this subsection, $G$ will denote \emph{any}
unimodular locally compact topological group,
and $K$ any closed subgroup of $G$.

\begin{definition}
  The \emph{Hecke algebra}
  \[ \HH(G, K) \coloneqq \QQ[K \backslash G \slash K] \]
  is defined as the space of compactly supported $K$-binvariant
  locally constant functions on $G$.

  Given two such functions $f_1$ and $f_2$ in $\HH(G,K)$,
  one can consider define the convolution
  \[ (f_1 \ast f_2)(g) \coloneqq \int_G f_1(g\inv x) f_2(x) \; \odif x \]
  which makes $\HH(G, K)$ into a $\QQ$-algebra,
  whose identity element is $\mathbf{1}_K$.
\end{definition}
In the case where $G$ is a reductive Lie group and
$K$ is the maximal compact subgroup
(or more generally whenever $(G,K)$ is a Gelfand pair),
this Hecke algebra is actually commutative.

\section{The specific Hecke algebras $\HH(G',K')$ and $\HH(G,K)$
  for $G' = \GL_n(E)$ and $G = \U(V_0)$, and the module $\HH(S_n(F), K')$}
For our purposes, we define two Hecke algebras:
\begin{align*}
  \HH(G', K') &\coloneqq \HH(\GL_n(E), \GL_n(\OO_E)) \\
  \HH(G, K) &\coloneqq \HH(\U(V_0), \U(V_0) \cap \GL_n(\OO_E))
\end{align*}

Now the symmetric space $S_n(F)$ is not a group,
so it does not make sense to define the same thing here.
Nevertheless, we introduce
\[ \HH(S_n(F), K') \coloneqq \mathcal C_{\mathrm{c}}^{\infty}(S_n(F))^{K'} \]
as the set of smooth compactly supported functions on $S_n(F)$
which are invariant under the action of $K' \subseteq G'$;
this is an $\HH(G', K')$-module, where the action of $f \in \HH(G', K')$ is given by
\[ f \cdot \varphi = {?} \]
\todo{how do I set RHS}
This does \textbf{not} have a multiplication structure at the moment, \emph{a priori},
although later we will see how one could be imposed.

Throughout this paper, to be unambiguous with the notation, we denote
\begin{itemize}
  \ii elements of $\HH(G,K)$ using $f$ or $f_i$ or similar
    (i.e.\ lowercase Roman letters);
  \ii elements of $\HH(G',K')$ by $f'$ or $f'_i$ or similar
    (i.e.\ lowercase Roman letters with apostrophes);
  \ii elements of $\HH(S_n(F),K')$ by $\phi$ or $\phi'_i$
    (i.e.\ lowercase Greek letters).
\end{itemize}

%Similarly, consider $S_n(F) \times V_n$.
%We set
%\[ \HH(S_n(F) \times V_n', {?}) \coloneqq \mathcal C_{\mathrm{c}}^{\infty}(S_n(F) \times V_n')^{K'} \]
%as the set of smooth compactly supported functions on $S_n(F) \times V_n'$
%which are invariant under the action of ${?} \subseteq G'$.
%\todo{This should be $\GL_n(\OO_F)$? Does it need another name?}
%This is an \dots

\section{Arches}
We introduce one more piece of notation for a common shape that our answers will take.

\begin{definition}
  Suppose $\{a_0, a_0 + 1, \dots, a_1\}$ is an interval of integers for some $a_0 \le a_1$,
  and consider two more integers $w_1$ and $w_2$ such that $w_1 + w_2 \le \frac{a_1-a_0}{2}$.
  Then we can define a piecewise linear function
  \[ \Arch_{[a_0, a_1]}(w_1, w_2) \colon \{a_0, a_0+1, \dots, a_1\} \to \ZZ_{\ge 0} \]
  according to the following definition:
  \[
    k \mapsto
    \begin{cases}
      k - a_0 & \text{if }a_0 \le k \le a_0 + w_1 \\
      w_1 + \left\lfloor \frac{k-(a_0+w_1)}{2} \right\rfloor & \text{if } a_0 + w_1 \le k \le a_0 + w_1 + w_2 \\
      w_1 + \left\lfloor \frac{w_2}{2} \right\rfloor & \text{if } a_0 + w_1 + w_2 \le k \le a_1 - (w_1 + w_2)\\
      w_1 + \left\lfloor \frac{(a_1-w_1) - k}{2} \right\rfloor & \text{if } a_1 - (w_1 + w_2) \le k \le a_1 - w_1 \\
      a_1 - k & \text{if }a_1 - w_1 \le k \le a_1.
    \end{cases}
  \]
\end{definition}
The nomenclature is meant to be indicative of the shape of the graph,
which looks a little bit like an arch.
It is a function symmetric around $\frac{a_0+a_1}{2}$ defined piecewise.
The function grows linearly with slope $1$ at the far left for $w_1$ steps,
then changes to slope $1/2$ for $w_2$ steps (rounding down),
before stabilizing, then doing the symmetric descent on the right half.
\begin{figure}[ht]
  \begin{center}
  \begin{asy}
    size(12cm);
    draw((-1,0)--(20,0));
    draw((0,0)--(3,3)--(7,5)--(12,5)--(16,3)--(19,0), lightred);
    draw((3,3)--(3,0), grey);
    draw((7,5)--(7,0), grey);
    draw((12,5)--(12,0), grey);
    draw((16,3)--(16,0), grey);
    real eps = 0.3;
    void brack(string s, real x0, real x1) {
      draw((x0+0.1,-eps)--(x0+0.1,-2*eps)--(x1-0.1,-2*eps)--(x1-0.1,-eps), blue);
      label(s, ((x0+x1)/2, -2*eps), dir(-90), blue);
    }
    brack("$w_1 = 3$", 0, 3);
    brack("$w_2 = 4$", 3, 7);
    brack("$w_2 = 4$", 12, 16);
    brack("$w_1 = 3$", 16, 19);

    dotfactor *= 1.5;
    dot("$(0,0)$", (0,0), dir(225));
    dot((1,1), red);
    dot((2,2), red);
    dot("$(3,3)$", (3,3), dir(135));
    dot((4,3), red);
    dot((5,4), red);
    dot((6,4), red);
    dot("$(7,5)$", (7,5), dir(90));
    dot((8,5), red);
    dot((9,5), red);
    dot((10,5), red);
    dot((11,5), red);
    dot("$(12,5)$", (12,5), dir(90));
    dot((13,4), red);
    dot((14,4), red);
    dot((15,3), red);
    dot("$(16,3)$", (16,3), dir(45));
    dot((17,2), red);
    dot((18,1), red);
    dot("$(19,0)$", (19,0), dir(315));

    label(rotate(45)*"Slope $+1$", (1.5,1.5), dir(135), lightred);
    label(rotate(26.57)*"Slope $+\frac12$", (5,4), dir(125), lightred);
    label(rotate(-26.57)*"Slope $-\frac12$", (14,4), dir(55), lightred);
    label(rotate(-45)*"Slope $-1$", (17.5,1.5), dir(45), lightred);
    label("Slope $0$", (9.5,5), dir(90), lightred);
  \end{asy}
  \end{center}
  \caption{A plot of $\Arch_{[0,19]}(3,4)$.}
  \label{fig:arch}
\end{figure}
